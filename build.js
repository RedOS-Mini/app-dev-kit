const dev_AL={backend:backend,windowId:windowId};console.log("Example test app");const winID=dev_AL.windowId;async function fetchAPI(url){const f=await fetch(url,{headers:{"ngrok-skip-browser-warning":!0}});return console.log("fetched from "+url),await f.json()}let list=await fetchAPI("https://thankful-bass-caring.ngrok-free.app/list");console.log("got list"),list=list.list;let appButtons=[];function clmp(a,b,c){return Math.min(Math.max(a,b),c)}let loginToken,username,state="home",viewApp={},isInstalled=!1,accountFlyout=!1,editingField1=!1,field1Content="",editingField2=!1,field2Content="",loading=!1,err=null,userData=null,lastState="home";const backButton=new dev_AL.backend.Button(250,-180,320,-140,3,224,132,126,1,winID,dev_AL.backend,(()=>{state="home",userData=null,scrollY=0}),(()=>{})),downloadButton=new dev_AL.backend.Button(-280,-15,-200,30,5,98,209,133,1,winID,dev_AL.backend,(()=>{dev_AL.backend.loadApp(viewApp.data),console.log(dev_AL.backend.ls("/system/apps")),isInstalled=!0}),(()=>{})),accountButton=new dev_AL.backend.Button(-320,-180,-275,-135,3,201,201,201,1,winID,dev_AL.backend,(()=>{accountFlyout=!accountFlyout,console.log("doot")}),(()=>{})),uploadButton=new dev_AL.backend.Button(260,150,320,180,3,54,184,28,1,winID,dev_AL.backend,(()=>{console.log("upload"),state="upload"}),(()=>{})),fieldInButton1=new dev_AL.backend.Button(-100,35,100,80,3,186,186,186,1,winID,dev_AL.backend,(()=>{editingField1=!0}),(()=>{})),fieldInButton2=new dev_AL.backend.Button(-100,-60,100,-15,3,186,186,186,1,winID,dev_AL.backend,(()=>{editingField2=!0}),(()=>{})),accountFlyout1=new dev_AL.backend.Button(-270,-150,-200,-130,3,191,191,191,1,winID,dev_AL.backend,(()=>{console.log("button 1"),field1Content="",field2Content="",err=null,loginToken?(state="projects",tryRefreshData()):state="login"}),(()=>{})),accountFlyout2=new dev_AL.backend.Button(-270,-175,-200,-155,3,191,191,191,1,winID,dev_AL.backend,(()=>{console.log("flyout2 click"),field2Content="",state=loginToken?"logout":"create"}),(()=>{}));let isWidget=!1;const widgetButton=new dev_AL.backend.Button(-100,-50,100,0,3,23,176,64,1,winID,dev_AL.backend,(()=>{isWidget=!isWidget}),(()=>{})),fieldEnterButton=new dev_AL.backend.Button(-80,-140,80,-95,3,72,201,46,1,winID,dev_AL.backend,(()=>{if(console.log("enter click"),"create"===state)loading=!0,fetch("https://thankful-bass-caring.ngrok-free.app/newaccount",{headers:{"Content-Type":"application/json"},body:JSON.stringify({username:field1Content,password:field2Content}),method:"POST"}).then((response=>{response.ok?response.json().then((value=>{loginToken=value.token,username=field1Content,loading=!1,state="home"})):response.json().then((value=>{err={time:Date.now(),message:value.error,code:response.status},console.error(err)}))}));else if("login"===state)loading=!0,fetch("https://thankful-bass-caring.ngrok-free.app/login",{headers:{"Content-Type":"application/json"},body:JSON.stringify({username:field1Content,password:field2Content}),method:"POST"}).then((response=>{response.ok?response.json().then((value=>{loginToken=value.token,username=field1Content,loading=!1,state="home"})):response.json().then((value=>{err={time:Date.now(),message:value.error,code:response.status},console.error(err)}))}));else if("upload"===state){let toUpload=dev_AL.backend.readFile("/system/apps/local/"+field1Content);if(console.log("/system/apps/local/"+field1Content),console.log(dev_AL.backend.fs),"object"!=typeof toUpload)try{toUpload=JSON.parse(toUpload)}catch{toUpload=void 0}if(!toUpload||"object"!=typeof toUpload)return err={time:Date.now(),message:"Invalid path! Path must lead to a file of data type object, include full file name.",code:404},void console.error(err);if("string"!=typeof toUpload.name||"object"!=typeof toUpload.data||"string"!=typeof toUpload.thumbnail||"string"!=typeof toUpload.description)return void(err={time:Date.now(),message:"Invalid or missing properties in app json!",code:400});list.find((a=>a.name===toUpload.name))?fetch("https://thankful-bass-caring.ngrok-free.app/updateapp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:loginToken,id:a.id,data:toUpload.data})}).then((response=>{if(response.ok)state="projects",tryRefreshData(),reset();else switch(response.status){case 401:err={time:Date.now(),message:"Login expired",code:401},console.error(err),state="home";break;case 404:err={time:Date.now(),message:"Someone logged into your account somewhere else",code:404},console.error(err),state="home";break;default:response.json().then((value=>{err={time:Date.now(),message:value.error,code:response.status},console.error(err),state="home"}))}})):fetch("https://thankful-bass-caring.ngrok-free.app/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:loginToken,name:toUpload.name,thumbnail:toUpload.thumbnail,description:toUpload.description,data:toUpload.data,type:isWidget?"widget":"app"})}).then((response=>{if(response.ok)state="projects",tryRefreshData(),reset();else switch(response.status){case 401:err={time:Date.now(),message:"Login expired",code:401},state="home";break;case 404:err={time:Date.now(),message:"Someone logged into your account somewhere else",code:404},state="home";break;case 429:err={time:Date.now(),message:"You can only post an app every 5 minutes!",code:429},state="home"}}))}}),(()=>{}));function tryRefreshData(){fetch("https://thankful-bass-caring.ngrok-free.app/userdata",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:loginToken})}).then((response=>{response.json().then((data=>{response.ok?userData=data.data:(loginToken=void 0,username=void 0,state="home",err={err:"Logged out",time:Date.now(),code:-1},console.warn("logged out"))}))}))}async function reset(){list=await fetchAPI("https://thankful-bass-caring.ngrok-free.app/list"),list=list.list,list.forEach((async(a,i)=>{dev_AL.backend.loadImage(a.thumbnail,a.id,winID),appButtons=[],appButtons.push(new dev_AL.backend.Button(-80,-45,80,45,0,0,0,0,1,winID,dev_AL.backend,(async()=>{state="app",console.log(a.id);let f=await fetch("https://thankful-bass-caring.ngrok-free.app/app",{body:JSON.stringify({name:a.id}),headers:{"Content-Type":"application/json"},method:"POST"});viewApp=(await f.json()).app,isInstalled=dev_AL.backend.ls("system/apps").includes(viewApp.data.id),console.log(viewApp)}),(()=>{})))})),console.log("reset")}document.addEventListener("keydown",(e=>{let oldText=editingField1?field1Content:editingField2?field2Content:"";"Backspace"===e.key?oldText=oldText.slice(0,oldText.length-1):e.key.length<=1&&(oldText+=e.key),editingField1?field1Content=oldText:editingField2&&(field2Content=oldText)})),console.log(list),list.forEach((async a=>{dev_AL.backend.loadImage(a.thumbnail,a.id,winID),appButtons.push(new dev_AL.backend.Button(-80,-45,80,45,0,0,0,0,1,winID,dev_AL.backend,(async()=>{state="app",console.log(a.id);let f=await fetch("https://thankful-bass-caring.ngrok-free.app/app",{body:JSON.stringify({name:a.id}),headers:{"Content-Type":"application/json"},method:"POST"});viewApp=(await f.json()).app,isInstalled=dev_AL.backend.ls("system/apps").includes(viewApp.data.id),console.log(viewApp)}),(()=>{})))})),console.log("got apps"),dev_AL.backend.loadImage("https://i.ibb.co/5RYXSJd/person-150dp-000000-FILL0-wght400-GRAD0-opsz48.png","account",winID),dev_AL.backend.loadImage("https://i.ibb.co/h9YJqW5/upload-2-100dp-E8-EAED-FILL0-wght400-GRAD0-opsz48.png","upload",winID),console.log("images loaded");let scrollY=0;document.addEventListener("wheel",(e=>{scrollY+=e.deltaY/8,scrollY=Math.max(scrollY,0)})),dev_AL.backend.onEvent("tick",(async()=>{if(dev_AL.backend.clearShapes(dev_AL.windowId),console.log("Loop"),state!==lastState&&(tryRefreshData(),field1Content="",field2Content=""),"home"===state){dev_AL.backend.drawCircle(0,50*Math.sin(Date.now()/100),100,255,0,0,255,dev_AL.windowId);let xOff=-1,yOff=0;list.forEach(((a,i)=>{const w=160,h=90,x=185*xOff,y=100*yOff+100+scrollY;appButtons[i].x1=x-80,appButtons[i].y1=y-45,appButtons[i].x2=x+80,appButtons[i].y2=y+45,appButtons[i].update(),dev_AL.backend.drawRect(x-82.5,y-47.5,x+82.5,y+47.5,3,0,0,0,1,winID),dev_AL.backend.drawImage(a.id,x,y,w,h,winID),dev_AL.backend.drawText(a.name,x,y-36,255,0,0,1,25,1,!0,"center",w,winID),xOff++,xOff>1&&(xOff=-1,yOff--)}));let hw=45,hh=45;accountButton.update(),accountFlyout=function prect(x1,y1,x2,y2,x,y){return clmp(x,x1,x2)===x&&clmp(y,y1,y2)===y}(-320,-180,-320+hw+100,-75,accountButton.mx,accountButton.my)&&accountFlyout,accountFlyout&&(dev_AL.backend.drawRect(-320+hw,-180,-320+hw+80,-90,2,161,161,161,1,winID),accountFlyout1.update(),accountFlyout2.update(),accountFlyout1.r=191*(accountFlyout1.held?.9:1),accountFlyout1.g=191*(accountFlyout1.held?.9:1),accountFlyout1.b=191*(accountFlyout1.held?.9:1),accountFlyout2.r=191*(accountFlyout2.held?.9:1),accountFlyout2.g=191*(accountFlyout2.held?.9:1),accountFlyout2.b=191*(accountFlyout2.held?.9:1),accountFlyout1.render(),dev_AL.backend.drawText(loginToken?"Account":"Login",-235,-140,0,0,0,1,20,1,!1,"center",100,winID),accountFlyout2.render(),dev_AL.backend.drawText(loginToken?"Logout":"Create",-235,-165,0,0,0,1,20,1,!1,"center",100,winID),loginToken&&dev_AL.backend.drawText(username,-235,-97.5,0,0,0,1,17.5,1,!0,"center",80,winID)),accountButton.r=201*(accountButton.held?.9:1),accountButton.g=201*(accountButton.held?.9:1),accountButton.b=201*(accountButton.held?.9:1),accountButton.render(),dev_AL.backend.drawImage("account",hw/2-320,hh/2-180,hw,hh,winID),err&&(dev_AL.backend.drawText(err.message,0,-160,255,0,0,1,35,1,!0,"center",300,winID),Date.now()-err.time>7500&&(err=null))}else if("app"===state)dev_AL.backend.drawImage(viewApp.id,160,90,320,180,winID),dev_AL.backend.drawRect(-320,-180,320,180,0,0,0,0,.6,winID),dev_AL.backend.drawText(viewApp.name,-300,140,255,255,255,1,55,1,!0,"left",200,winID),dev_AL.backend.drawText("By @"+viewApp.author,-300,110,132,173,240,1,35,1,!0,"left",200,winID),dev_AL.backend.drawText("Last updated "+viewApp.time,-300,90,185,235,228,1,25,1,!1,"left",200,winID),dev_AL.backend.drawText(viewApp.id,-300,80,185,235,228,1,10,1,!1,"left",200,winID),dev_AL.backend.drawText(viewApp.description,-300,60,255,255,255,1,15,1,!1,"left",200,winID),dev_AL.backend.drawText(isInstalled?"Installed":"Not installed",-185,140,93,195,199,1,25,1,!0,"left",200,winID),downloadButton.update(),downloadButton.r=98*(downloadButton.held?.8:1),downloadButton.g=209*(downloadButton.held?.8:1),downloadButton.b=133*(downloadButton.held?.8:1),downloadButton.render(),dev_AL.backend.drawText("Download",-240,7.5,0,0,0,1,25,1,!0,"center",80,winID);else if("login"===state)dev_AL.backend.drawText("Login",0,130,0,0,0,1,55,1,!0,"center",1e3,winID),dev_AL.backend.drawText("Username:",0,100,0,0,0,1,40,1,!0,"center",1e3,winID),dev_AL.backend.drawText("Password:",0,5,0,0,0,1,40,1,!0,"center",1e3,winID),fieldInButton1.update(),fieldInButton2.update(),fieldEnterButton.update(),!fieldInButton1.hover&&fieldInButton1.lastMouse&&(editingField1=!1),!fieldInButton2.hover&&fieldInButton2.lastMouse&&(editingField2=!1),dev_AL.backend.drawRect(-102.5,32.5,102.5,82.5,3,135,135,135,1,winID),dev_AL.backend.drawRect(-102.5,-62.5,102.5,-12.5,3,135,135,135,1,winID),dev_AL.backend.drawRect(fieldEnterButton.x1-2.5,fieldEnterButton.y1-2.5,fieldEnterButton.x2+2.5,fieldEnterButton.y2+2.5,3,41,125,24,1,winID),fieldInButton1.r=186*(editingField1?.9:1),fieldInButton1.g=186*(editingField1?.9:1),fieldInButton1.b=186*(editingField1?.9:1),fieldInButton2.r=186*(editingField2?.9:1),fieldInButton2.g=186*(editingField2?.9:1),fieldInButton2.b=186*(editingField2?.9:1),fieldInButton2.render(),fieldInButton1.render(),fieldEnterButton.render(),dev_AL.backend.drawText(field1Content,-90,57.5,0,0,0,1,35,1,!1,"left",180,winID),dev_AL.backend.drawText(field2Content,-90,-37.5,0,0,0,1,35,1,!1,"left",180,winID),dev_AL.backend.drawText("Login",0,-117.5,0,0,0,1,35,1,!1,"center",180,winID),err&&(console.log(err.message),dev_AL.backend.drawText(err.message,0,-160,255,0,0,1,35,1,!0,"center",300,winID),Date.now()-err.time>7500&&(err=null));else if("create"===state)dev_AL.backend.drawText("Create",0,130,0,0,0,1,55,1,!0,"center",1e3,winID),dev_AL.backend.drawText("Username:",0,100,0,0,0,1,40,1,!0,"center",1e3,winID),dev_AL.backend.drawText("Password:",0,5,0,0,0,1,40,1,!0,"center",1e3,winID),fieldInButton1.update(),fieldInButton2.update(),fieldEnterButton.update(),!fieldInButton1.hover&&fieldInButton1.lastMouse&&(editingField1=!1),!fieldInButton2.hover&&fieldInButton2.lastMouse&&(editingField2=!1),dev_AL.backend.drawRect(-102.5,32.5,102.5,82.5,3,135,135,135,1,winID),dev_AL.backend.drawRect(-102.5,-62.5,102.5,-12.5,3,135,135,135,1,winID),dev_AL.backend.drawRect(fieldEnterButton.x1-2.5,fieldEnterButton.y1-2.5,fieldEnterButton.x2+2.5,fieldEnterButton.y2+2.5,3,41,125,24,1,winID),fieldInButton1.r=186*(editingField1?.9:1),fieldInButton1.g=186*(editingField1?.9:1),fieldInButton1.b=186*(editingField1?.9:1),fieldInButton2.r=186*(editingField2?.9:1),fieldInButton2.g=186*(editingField2?.9:1),fieldInButton2.b=186*(editingField2?.9:1),fieldInButton1.y1=35,fieldInButton1.y2=80,fieldInButton2.render(),fieldInButton1.render(),fieldEnterButton.render(),dev_AL.backend.drawText(field1Content,-90,57.5,0,0,0,1,35,1,!1,"left",180,winID),dev_AL.backend.drawText(field2Content,-90,-37.5,0,0,0,1,35,1,!1,"left",180,winID),dev_AL.backend.drawText("Create",0,-117.5,0,0,0,1,35,1,!1,"center",180,winID),err&&(dev_AL.backend.drawText(err.message,0,-160,255,0,0,1,35,1,!0,"center",300,winID),Date.now()-err.time>7500&&(err=null));else if("logout"===state)loginToken=void 0,state="home",accountFlyout=!1;else if("projects"===state){dev_AL.backend.drawText("Your account",0,150,0,0,0,1,35,1,!0,"center",200,winID);let xOff=-1,yOff=0;Object.values(userData.apps).forEach((a=>{const w=160,x=185*xOff,y=100*yOff+60+scrollY;dev_AL.backend.drawRect(x-82.5,y-47.5,x+82.5,y+47.5,3,0,0,0,1,winID),dev_AL.backend.drawImage(a.id,x,y,w,90,winID),dev_AL.backend.drawText(a.name,x,y-36,255,0,0,1,25,1,!0,"center",w,winID),xOff++,xOff>1&&(xOff=-1,yOff--)})),uploadButton.update(),uploadButton.render(),dev_AL.backend.drawImage("upload",290,165,25,25,winID)}else"upload"===state&&(fieldInButton1.update(),fieldEnterButton.update(),widgetButton.update(),!fieldInButton1.hover&&fieldInButton1.lastMouse&&(editingField1=!1),isWidget?(widgetButton.r=23,widgetButton.g=176,widgetButton.b=64):(widgetButton.r=23,widgetButton.g=125,widgetButton.b=176),dev_AL.backend.drawRect(fieldInButton1.x1-2.5,fieldInButton1.y1-2.5,fieldInButton1.x2+2.5,fieldInButton1.y2+2.5,3,135,135,135,1,winID),dev_AL.backend.drawRect(widgetButton.x1-2.5,widgetButton.y1-2.5,widgetButton.x2+2.5,widgetButton.y2+2.5,3,.8*widgetButton.r,.8*widgetButton.g,.8*widgetButton.b,1,winID),dev_AL.backend.drawRect(fieldEnterButton.x1-2.5,fieldEnterButton.y1-2.5,fieldEnterButton.x2+2.5,fieldEnterButton.y2+2.5,3,41,125,24,1,winID),fieldInButton1.r=186*(editingField1?.9:1),fieldInButton1.g=186*(editingField1?.9:1),fieldInButton1.b=186*(editingField1?.9:1),fieldInButton1.render(),fieldEnterButton.render(),widgetButton.render(),dev_AL.backend.drawText(field1Content,-90,(fieldInButton1.y1+fieldInButton1.y2)/2,0,0,0,1,35,1,!1,"left",180,winID),dev_AL.backend.drawText("App type: "+(isWidget?"widget":"app"),0,(widgetButton.y1+widgetButton.y2)/2,0,0,0,1,35,1,!1,"center",200,winID),dev_AL.backend.drawText("File name in /system/apps/local",0,115,0,0,0,1,35,1,!1,"center",300,winID),dev_AL.backend.drawText("Upload",0,(fieldEnterButton.y1+fieldEnterButton.y2)/2,0,0,0,1,35,1,!1,"center",200,winID),err&&(dev_AL.backend.drawText(err.message,100,0,255,0,0,1,35,1,!0,"left",200,winID),Date.now()-err.time>5e3&&(err=null)));"home"!==state&&(backButton.update(),backButton.render(),dev_AL.backend.drawText("Back",285,-165.5,0,0,0,1,25,1,!0,"center",200,winID)),lastState=state}),dev_AL.windowId);